# Traefik with docker discovery example

Простой пример интеграции балансера Traefik и сервиса hello-world,
запущенных на одном сервере в пределах одного Docker daemon.

Traefik подписывается на события старта/стопа контейнеров и на основе
labels перенаправляет трафик на нужный контейнер. Также Traefik занимается
выпуском сертификатов Lets Encrypt, поэтому ему не нужен внешний слой
"терминации SSL".

Каждый контейнер сам публикует свой конфиг через labels, поэтому сервисы
и балансер могут (и должны) быть разделены и конфигурируются отдельно.
Не нужно править конфиг в балансере после обновления сервиса, что облегчает
поддержку всей системы.

## Общая схема работы

Traefik и все сервисы запущены на одном сервере и работают в одной сети.
Для этого перед запуском мы единожды создаем сеть "traefik", в которую
добавляются как сам балансер, так и все сервисы. Также в рамках каждого
docker-compose.yml создается сеть по умолчанию "default" для общения
контейнеров внутри одного docker-compose.yml. С такой схемой мы можем
добавлять в сеть "traefik" только те контейнеры, доступ до которых
нужен снаружи, при этом остальные контейнеры с наружи не доступны.

В нашем примере доступен снаружи только контейнер hello-world, а БД
postgres доступна только контейнеру hello-world.

Здесь Traefik и сервис представлены в рамках одного репозитория, но
по-хорошему они должны быть разделены. 

## Перед стартом
```bash
docker network create --attachable traefik
cp hello-world-service/example.env hello-world-service/.env
```
Откройте файл `hello-world-service/.env` и замените значения по умолчанию на свои.
Также откройте файл `hello-world-service/docker-compose.yaml` и замените
домен по умолчанию `hello-world.example.com` на свой.

## Старт
```bash
cd traefik
docker-compose up -d
cd ../hello-world-service
docker-compose up -d --build
```
